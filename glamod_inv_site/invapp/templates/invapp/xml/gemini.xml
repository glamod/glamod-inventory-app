<?xml version="1.0"?>
<gmd:MD_Metadata xmlns:gmd="http://www.isotc211.org/2005/gmd"  xmlns:gml="http://www.opengis.net/gml/3.2" xmlns:gco="http://www.isotc211.org/2005/gco" xmlns:gmx="http://www.isotc211.org/2005/gmx" xmlns:srv="http://www.isotc211.org/2005/srv" xmlns:xlink="http://www.w3.org/1999/xlink">
      <gmd:fileIdentifier>
        <gco:CharacterString>{{ ob_id }}</gco:CharacterString>
      </gmd:fileIdentifier>
      <gmd:language>
        <gmd:LanguageCode codeList="http://www.loc.gov/standards/iso639-2/php/code_list.php" codeListValue="eng">English</gmd:LanguageCode>
      </gmd:language>
      {% if parent_identifier %}
      <gmd:parentIdentifier>
        <gco:CharacterString>{{ parent_identifier }}</gco:CharacterString>
      </gmd:parentIdentifier>
      {% endif %}
      <gmd:hierarchyLevel>
        <gmd:MD_ScopeCode codeList="http://standards.iso.org/ittf/PubliclyAvailableStandards/ISO_19139_Schemas/resources/codelist/gmxCodelists.xml#MD_ScopeCode" codeListValue="{{ heir_level }}">{{ heir_level }}</gmd:MD_ScopeCode>
      </gmd:hierarchyLevel>
      <gmd:contact>
        <gmd:CI_ResponsibleParty>
          <gmd:individualName>
            <gco:CharacterString>Data Center Contact</gco:CharacterString>
          </gmd:individualName>
          <gmd:organisationName>
            <gco:CharacterString>{{ contact.lastName|default:" " }}</gco:CharacterString>
          </gmd:organisationName>
          <gmd:positionName>
            <gco:CharacterString>Data Center Contact</gco:CharacterString>
          </gmd:positionName>
          <gmd:contactInfo>
            <gmd:CI_Contact>
              <gmd:phone>
                <gmd:CI_Telephone>
                  <gmd:voice>
                    <gco:CharacterString>{{contact.phone|default:" " }}</gco:CharacterString>
                  </gmd:voice>
                </gmd:CI_Telephone>
              </gmd:phone>
              <gmd:address>
                <gmd:CI_Address>
                  <gmd:deliveryPoint>
                    <gco:CharacterString>{{contact.lastName|default:" " }}</gco:CharacterString>
                  </gmd:deliveryPoint>
                  <gmd:deliveryPoint>
                    <gco:CharacterString>{{contact.deliveryPoint|default:" " }}</gco:CharacterString>
                  </gmd:deliveryPoint>
                  <gmd:deliveryPoint>
                    <gco:CharacterString>{{contact.administrativeArea|default:" " }}</gco:CharacterString>
                  </gmd:deliveryPoint>
                  <gmd:city>
                    <gco:CharacterString>{{contact.city|default:" " }}</gco:CharacterString>
                  </gmd:city>
                  <gmd:postalCode>
                    <gco:CharacterString>{{contact.postalCode|default:" " }}</gco:CharacterString>
                  </gmd:postalCode>
                  <gmd:electronicMailAddress>
                    <gco:CharacterString>{{contact.electronicEmailAddress|default:" " }}</gco:CharacterString>
                  </gmd:electronicMailAddress>
                </gmd:CI_Address>
              </gmd:address>
            </gmd:CI_Contact>
          </gmd:contactInfo>
          <gmd:role>
            <gmd:CI_RoleCode codeList="http://standards.iso.org/ittf/PubliclyAvailableStandards/ISO_19139_Schemas/resources/codelist/gmxCodelists.xml#CI_RoleCode" codeListValue="pointOfContact">pointOfContact</gmd:CI_RoleCode>
          </gmd:role>
        </gmd:CI_ResponsibleParty>
      </gmd:contact>
      <gmd:dateStamp>
        <gco:DateTime>{{date_stamp|date:"Y-m-d\TH:i:s"}}</gco:DateTime>
      </gmd:dateStamp>
      <gmd:metadataStandardName>
        <gco:CharacterString>UK GEMINI</gco:CharacterString>
      </gmd:metadataStandardName>
      <gmd:metadataStandardVersion>
        <gco:CharacterString>2.1</gco:CharacterString>
      </gmd:metadataStandardVersion>
      <gmd:referenceSystemInfo>
        <gmd:MD_ReferenceSystem>
          <gmd:referenceSystemIdentifier>
            <gmd:RS_Identifier>
              <gmd:code>
                <gco:CharacterString>urn:ogc:def:crs:EPSG::27700</gco:CharacterString>
              </gmd:code>
            </gmd:RS_Identifier>
          </gmd:referenceSystemIdentifier>
        </gmd:MD_ReferenceSystem>
      </gmd:referenceSystemInfo>
      <gmd:identificationInfo>
        <gmd:MD_DataIdentification>
          <gmd:citation>
            <gmd:CI_Citation>
              <gmd:title>
                <gco:CharacterString>{{obj.title|default:" " }}</gco:CharacterString>
              </gmd:title>
              <gmd:date>
                <gmd:CI_Date>
                  <gmd:date>
                    <gco:DateTime>{{obj.dataPublishedTime|date:"Y-m-d\TH:i:s"}}</gco:DateTime>
                  </gmd:date>
                  <gmd:dateType>
                    <gmd:CI_DateTypeCode codeList="http://standards.iso.org/ittf/PubliclyAvailableStandards/ISO_19139_Schemas/resources/codelist/gmxCodelists.xml#CI_DateTypeCode" codeListValue="publication">publication</gmd:CI_DateTypeCode>
                  </gmd:dateType>
                </gmd:CI_Date>
              </gmd:date>
              <gmd:date>
                <gmd:CI_Date>
                  <gmd:date>
                    <gco:DateTime>{{obj.dataPublishedTime|date:"Y-m-d\TH:i:s"}}</gco:DateTime>
                  </gmd:date>
                  <gmd:dateType>
                    <gmd:CI_DateTypeCode codeList="http://standards.iso.org/ittf/PubliclyAvailableStandards/ISO_19139_Schemas/resources/codelist/gmxCodelists.xml#CI_DateTypeCode" codeListValue="creation">creation</gmd:CI_DateTypeCode>
                  </gmd:dateType>
                </gmd:CI_Date>
              </gmd:date>
              <gmd:identifier>
                <gmd:RS_Identifier>
                  <gmd:code>
                    <gco:CharacterString>{{obj.uuid|default:" " }}</gco:CharacterString>
                  </gmd:code>
                  <gmd:codeSpace>
                    <gco:CharacterString>{{publisher.lastName|default:" " }}</gco:CharacterString>
                  </gmd:codeSpace>
                </gmd:RS_Identifier>
              </gmd:identifier>
                {% if obj.drsdataset_set.all %}
                  {% for drs_dataset in obj.drsdataset_set.all %}
                 <gmd:identifier>
                  <gmd:RS_Identifier>
                    <gmd:code>
                      <gco:CharacterString>{{ drs_dataset.getFullId|default:" " }}</gco:CharacterString>
                    </gmd:code>
                    <gmd:codeSpace>
                      <gco:CharacterString>alternative.identifier</gco:CharacterString>
                    </gmd:codeSpace>
                  </gmd:RS_Identifier>
                 </gmd:identifier>
                  {% endfor %}
                {% endif %}                
              
            </gmd:CI_Citation>
          </gmd:citation>
          <gmd:abstract>
            <gco:CharacterString>{{obj.abstract|default:" " }}</gco:CharacterString>
          </gmd:abstract>

          {% for party in parties %}
          <gmd:pointOfContact>
            <gmd:CI_ResponsibleParty>
              <gmd:individualName>
                <gco:CharacterString>{{party.0|default:" " }}</gco:CharacterString>
              </gmd:individualName>
              <gmd:organisationName>
                <gco:CharacterString>{{party.1.deliveryPoint|default:" " }}</gco:CharacterString>
              </gmd:organisationName>
              <gmd:positionName>
                <gco:CharacterString>contact</gco:CharacterString>
              </gmd:positionName>
              <gmd:contactInfo>
                <gmd:CI_Contact>
                  <gmd:phone>
                    <gmd:CI_Telephone>
                      <gmd:voice>
                        <gco:CharacterString>{{party.1.phone|default:" " }}</gco:CharacterString>
                      </gmd:voice>
                    </gmd:CI_Telephone>
                  </gmd:phone>
                  <gmd:address>
                    <gmd:CI_Address>
                      <gmd:deliveryPoint>
                        <gco:CharacterString>{{party.1.lastName|default:" " }}</gco:CharacterString>
                      </gmd:deliveryPoint>
                      <gmd:deliveryPoint>
                        <gco:CharacterString>{{party.1.deliveryPoint|default:" " }}</gco:CharacterString>
                      </gmd:deliveryPoint>
                      <gmd:deliveryPoint>
                        <gco:CharacterString>{{party.1.administrativeArea|default:" " }}</gco:CharacterString>
                      </gmd:deliveryPoint>
                      <gmd:city>
                        <gco:CharacterString>{{party.1.city|default:" " }}</gco:CharacterString>
                      </gmd:city>
                      <gmd:postalCode>
                        <gco:CharacterString>{{party.1.postalCode|default:" " }}</gco:CharacterString>
                      </gmd:postalCode>
                      <gmd:electronicMailAddress>
                        <gco:CharacterString>{{party.1.electronicEmailAddress|default:" " }}</gco:CharacterString>
                      </gmd:electronicMailAddress>
                    </gmd:CI_Address>
                  </gmd:address>
                </gmd:CI_Contact>
              </gmd:contactInfo>
              <gmd:role>
                <gmd:CI_RoleCode codeList="http://standards.iso.org/ittf/PubliclyAvailableStandards/ISO_19139_Schemas/resources/codelist/gmxCodelists.xml#CI_RoleCode" codeListValue="{{party.2}}">{{party.2}}</gmd:CI_RoleCode>
              </gmd:role>
            </gmd:CI_ResponsibleParty>
          </gmd:pointOfContact>
          {% endfor %}
          <gmd:resourceMaintenance>
            <gmd:MD_MaintenanceInformation>
              <gmd:maintenanceAndUpdateFrequency>
                <gmd:MD_MaintenanceFrequencyCode codeList="http://standards.iso.org/ittf/PubliclyAvailableStandards/ISO_19139_Schemas/resources/codelist/gmxCodelists.xml#MD_MaintenanceFrequencyCode" codeListValue="{{update_frequency}}">{{update_frequency}}</gmd:MD_MaintenanceFrequencyCode>
              </gmd:maintenanceAndUpdateFrequency>
            </gmd:MD_MaintenanceInformation>
          </gmd:resourceMaintenance>
          <gmd:resourceFormat>
            <gmd:MD_Format>
              <gmd:name>
                <gco:CharacterString>{{format|default:" " }}</gco:CharacterString>
              </gmd:name>
              <gmd:version  gco:nilReason="inapplicable"/>
            </gmd:MD_Format>
          </gmd:resourceFormat>
          <gmd:descriptiveKeywords>
            <gmd:MD_Keywords>
          	{% for key, value in metadata_publication_id.items %}
              <gmd:keyword>
              {% if value %}
              		<gmx:Anchor xlink:href="{{ value.href }}" xlink:title="{{ value.title }}">{{ key }}</gmx:Anchor>
              {% else %}
                	<gmx:Anchor>{{ key }}</gmx:Anchor>
              {% endif %}
              </gmd:keyword>
          	{% endfor %}
          	{% for vkw in vocabulary_keywords.all %}
              <gmd:keyword>
              		<gmx:Anchor xlink:href="{{ vkw.uri }}" xlink:title="{{ vkw.resolvedTerm }}">{{ vkw.resolvedTerm }}</gmx:Anchor>
              </gmd:keyword>
          	{% endfor %}
            </gmd:MD_Keywords>
          </gmd:descriptiveKeywords>
          <gmd:descriptiveKeywords>
            <gmd:MD_Keywords>
              <gmd:keyword>
                <gco:CharacterString>{{inspire_theme|default:" " }}</gco:CharacterString>
              </gmd:keyword>
              <gmd:thesaurusName>
                <gmd:CI_Citation>
                  <gmd:title>
                    <gco:CharacterString>GEMET - INSPIRE themes, version 1.0</gco:CharacterString>
                  </gmd:title>
                  <gmd:date>
                    <gmd:CI_Date>
                      <gmd:date>
                        <gco:DateTime>{{date_stamp|date:"Y-m-d\TH:i:s"}}</gco:DateTime>
                      </gmd:date>
                      <gmd:dateType>
                        <gmd:CI_DateTypeCode codeList="http://standards.iso.org/ittf/PubliclyAvailableStandards/ISO_19139_Schemas/resources/codelist/gmxCodelists.xml#CI_DateTypeCode" codeListValue="publication">publication</gmd:CI_DateTypeCode>
                      </gmd:dateType>
                    </gmd:CI_Date>
                  </gmd:date>
                </gmd:CI_Citation>
              </gmd:thesaurusName>
            </gmd:MD_Keywords>
          </gmd:descriptiveKeywords>
          <gmd:resourceConstraints>
            <gmd:MD_Constraints>
              <gmd:useLimitation>
                <gco:CharacterString>{{licence_info.text|default:" " }}</gco:CharacterString>
              </gmd:useLimitation>
            </gmd:MD_Constraints>
          </gmd:resourceConstraints>
          <gmd:resourceConstraints>
            <gmd:MD_LegalConstraints>
              <gmd:accessConstraints>
                <gmd:MD_RestrictionCode codeList="http://standards.iso.org/ittf/PubliclyAvailableStandards/ISO_19139_Schemas/resources/codelist/gmxCodelists.xml#MD_RestrictionCode" codeListValue="otherRestrictions">otherRestrictions</gmd:MD_RestrictionCode>
              </gmd:accessConstraints>
              <gmd:otherConstraints>
                {% if access_info %}
                <gco:CharacterString>{{access_info.text|default:" " }}</gco:CharacterString>
                {% else %}
                <gco:CharacterString>None</gco:CharacterString>
                {% endif %}
              </gmd:otherConstraints>
            </gmd:MD_LegalConstraints>
          </gmd:resourceConstraints>
          <gmd:spatialResolution>
            <gmd:MD_Resolution>
                <gmd:distance  gco:nilReason="inapplicable"/>
            </gmd:MD_Resolution>
          </gmd:spatialResolution>
          <gmd:language>
            <gmd:LanguageCode codeList="http://www.loc.gov/standards/iso639-2/php/code_list.php" codeListValue="eng">English</gmd:LanguageCode>
          </gmd:language>
          <gmd:topicCategory>
            <gmd:MD_TopicCategoryCode>{{topic_category}}</gmd:MD_TopicCategoryCode>
          </gmd:topicCategory>
          <gmd:extent>
            <gmd:EX_Extent>
              <gmd:geographicElement>
                <gmd:EX_GeographicBoundingBox>
                  <gmd:westBoundLongitude>
                    <gco:Decimal>{{bbox.w}}</gco:Decimal>
                  </gmd:westBoundLongitude>
                  <gmd:eastBoundLongitude>
                    <gco:Decimal>{{bbox.e}}</gco:Decimal>
                  </gmd:eastBoundLongitude>
                  <gmd:southBoundLatitude>
                    <gco:Decimal>{{bbox.s}}</gco:Decimal>
                  </gmd:southBoundLatitude>
                  <gmd:northBoundLatitude>
                    <gco:Decimal>{{bbox.n}}</gco:Decimal>
                  </gmd:northBoundLatitude>
                </gmd:EX_GeographicBoundingBox>
              </gmd:geographicElement>
            </gmd:EX_Extent>
          </gmd:extent>
          <gmd:extent>
            <gmd:EX_Extent>
               <gmd:temporalElement>
                 <gmd:EX_TemporalExtent>
                   <gmd:extent>
                     <!-- Only one of these by default in CEDA catalogue for now -->
                     <gml:TimePeriod gml:id="CEDA01">
                       <gml:beginPosition>{{start_time}}</gml:beginPosition>
                       {% if end_time != 'Ongoing' %}
                       <gml:endPosition>{{end_time}}</gml:endPosition>
                       {% endif %}
                     </gml:TimePeriod>
                   </gmd:extent>
                 </gmd:EX_TemporalExtent>
               </gmd:temporalElement>
             </gmd:EX_Extent>
           </gmd:extent>
        </gmd:MD_DataIdentification>
      </gmd:identificationInfo>
      <gmd:distributionInfo>
        <gmd:MD_Distribution>
          <gmd:distributionFormat  gco:nilReason="inapplicable"/>
          <gmd:distributor>
            <gmd:MD_Distributor>
              <gmd:distributorContact>
                <gmd:CI_ResponsibleParty>
                  <gmd:individualName>
                    <gco:CharacterString>{{publisher|default:" "}}</gco:CharacterString>
                  </gmd:individualName>
                  <gmd:organisationName>
                    <gco:CharacterString>{{contact.lastName|default:" " }}</gco:CharacterString>
                  </gmd:organisationName>
                  <gmd:positionName>
                    <gco:CharacterString>Data Center Contact</gco:CharacterString>
                  </gmd:positionName>
                  <gmd:contactInfo>
                    <gmd:CI_Contact>
                      <gmd:phone>
                        <gmd:CI_Telephone>
                          <gmd:voice>
                            <gco:CharacterString>{{contact.phone|default:" " }}</gco:CharacterString>
                          </gmd:voice>
                        </gmd:CI_Telephone>
                      </gmd:phone>
                      <gmd:address>
                        <gmd:CI_Address>
                          <gmd:deliveryPoint>
                            <gco:CharacterString>{{contact.lastName|default:" " }}</gco:CharacterString>
                          </gmd:deliveryPoint>
                          <gmd:deliveryPoint>
                            <gco:CharacterString>{{contact.deliveryPoint|default:" " }}</gco:CharacterString>
                          </gmd:deliveryPoint>
                          <gmd:deliveryPoint>
                            <gco:CharacterString>{{contact.administrativeArea|default:" " }}</gco:CharacterString>
                          </gmd:deliveryPoint>
                          <gmd:city>
                            <gco:CharacterString>{{contact.city|default:" " }}</gco:CharacterString>
                          </gmd:city>
                          <gmd:postalCode>
                            <gco:CharacterString>{{contact.postalCode|default:" " }}</gco:CharacterString>
                          </gmd:postalCode>
                          <gmd:electronicMailAddress>
                            <gco:CharacterString>{{contact.electronicEmailAddress|default:" " }}</gco:CharacterString>
                          </gmd:electronicMailAddress>
                        </gmd:CI_Address>
                      </gmd:address>
                    </gmd:CI_Contact>
                  </gmd:contactInfo>
                  <gmd:role>
                    <gmd:CI_RoleCode codeList="http://standards.iso.org/ittf/PubliclyAvailableStandards/ISO_19139_Schemas/resources/codelist/gmxCodelists.xml#CI_RoleCode" codeListValue="distributor">distributor</gmd:CI_RoleCode>
                  </gmd:role>
                </gmd:CI_ResponsibleParty>
              </gmd:distributorContact>
            </gmd:MD_Distributor>
          </gmd:distributor>
          <gmd:transferOptions>
            <gmd:MD_DigitalTransferOptions>
              <gmd:onLine>
                <gmd:CI_OnlineResource>
                  <gmd:linkage>
                    <gmd:URL>http://catalogue.ceda.ac.uk/uuid/{{obj.uuid}}</gmd:URL>
                  </gmd:linkage>
                  <gmd:name>
                    <gco:CharacterString>Dataset Homepage</gco:CharacterString>
                  </gmd:name>
                  <gmd:description>
                    <gco:CharacterString> </gco:CharacterString>
                  </gmd:description>
                  <gmd:function>
                    <gmd:CI_OnLineFunctionCode codeList="http://standards.iso.org/ittf/PubliclyAvailableStandards/ISO_19139_Schemas/resources/codelist/gmxCodelists.xml#CI_OnLineFunctionCode" codeListValue="information">information</gmd:CI_OnLineFunctionCode>
                  </gmd:function>
                </gmd:CI_OnlineResource>
              </gmd:onLine>
            </gmd:MD_DigitalTransferOptions>
          </gmd:transferOptions>
          {% if heir_level == 'dataset' %}
          <gmd:transferOptions>
            <gmd:MD_DigitalTransferOptions>
              <gmd:onLine>
                <gmd:CI_OnlineResource>
                  <gmd:linkage>
                    <gmd:URL>{{download}}</gmd:URL>
                  </gmd:linkage>
                  <gmd:name>
                    <gco:CharacterString>DOWNLOAD</gco:CharacterString>
                  </gmd:name>
                  <gmd:description>
                    <gco:CharacterString>Download Data</gco:CharacterString>
                  </gmd:description>
                  <gmd:function>
                    <gmd:CI_OnLineFunctionCode codeList="http://standards.iso.org/ittf/PubliclyAvailableStandards/ISO_19139_Schemas/resources/codelist/gmxCodelists.xml#CI_OnLineFunctionCode" codeListValue="download">download</gmd:CI_OnLineFunctionCode>
                  </gmd:function>
                </gmd:CI_OnlineResource>
              </gmd:onLine>
            </gmd:MD_DigitalTransferOptions>
          </gmd:transferOptions>
          {% endif %}
          {% if documents %}
          {% for key, value in documents.items %}
		  <gmd:transferOptions>
            <gmd:MD_DigitalTransferOptions>
              <gmd:onLine>
                <gmd:CI_OnlineResource>
                  <gmd:linkage>
                    <gmd:URL>{{ key }}</gmd:URL>
                  </gmd:linkage>
                  <gmd:name>
                    <gco:CharacterString>{{ value|default:" "  }}</gco:CharacterString>
                  </gmd:name>
                  <gmd:description>
                    <gco:CharacterString> </gco:CharacterString>
                  </gmd:description>
                  <gmd:function>
                    <gmd:CI_OnLineFunctionCode codeList="http://standards.iso.org/ittf/PubliclyAvailableStandards/ISO_19139_Schemas/resources/Codelist/gmxCodelists.xml#CI_OnLineFunctionCode" codeListValue="information">information</gmd:CI_OnLineFunctionCode>
                  </gmd:function>
                </gmd:CI_OnlineResource>
              </gmd:onLine>
            </gmd:MD_DigitalTransferOptions>
          </gmd:transferOptions>
          {% endfor %}
          {% endif %}
        </gmd:MD_Distribution>
      </gmd:distributionInfo>
      <gmd:dataQualityInfo>
        <gmd:DQ_DataQuality>
          <gmd:scope>
            <gmd:DQ_Scope>
              <gmd:level>
                <gmd:MD_ScopeCode codeList="http://standards.iso.org/ittf/PubliclyAvailableStandards/ISO_19139_Schemas/resources/codelist/gmxCodelists.xml#MD_ScopeCode" codeListValue="{{heir_level}}">{{heir_level}}</gmd:MD_ScopeCode>
              </gmd:level>
            </gmd:DQ_Scope>
          </gmd:scope>
          <gmd:lineage>
            <gmd:LI_Lineage>
              <gmd:statement>
                <gco:CharacterString>{{data_lineage|default:" " }}</gco:CharacterString>
              </gmd:statement>
            </gmd:LI_Lineage>
          </gmd:lineage>
        </gmd:DQ_DataQuality>
      </gmd:dataQualityInfo>     
    </gmd:MD_Metadata>
